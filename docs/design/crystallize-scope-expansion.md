# Extended /crystallize Command Design

## Overview

Extend the `/crystallize` command to support three different output types:
1. Commands (executable tools)
2. Documents (markdown artifacts)
3. Data Management (CRUD commands)

## Command Syntax

```bash
/crystallize              # AI decides based on context
/crystallize command      # Force command creation
/crystallize document     # Create markdown artifact
/crystallize data         # Create CRUD command
```

## Implementation Plan

### 1. Update Interactive Session (cli/src/interactive.rs)

```rust
fn handle_special_command(&mut self, input: &str) -> Result<bool> {
    match input {
        "/crystallize" => {
            self.request_crystallization(CrystallizeType::Auto)?;
            Ok(true)
        }
        "/crystallize command" => {
            self.request_crystallization(CrystallizeType::Command)?;
            Ok(true)
        }
        "/crystallize document" => {
            self.request_crystallization(CrystallizeType::Document)?;
            Ok(true)
        }
        "/crystallize data" => {
            self.request_crystallization(CrystallizeType::Data)?;
            Ok(true)
        }
        // ... other commands
    }
}

enum CrystallizeType {
    Auto,
    Command,
    Document,
    Data,
}
```

### 2. Update Daemon Types (daemon/possession.go)

```go
// ArtifactSpec for documents and data
type ArtifactSpec struct {
    Type        string `json:"type"`        // "document" or "data"
    Name        string `json:"name"`
    Description string `json:"description"`
    Content     string `json:"content"`     // For documents
    Schema      string `json:"schema"`      // For data
    Operations  []string `json:"operations"` // For data: ["create", "list", "update", "delete"]
}

// Update session to support both
type Session struct {
    // ... existing fields
    CommandGenerated  *CommandSpec  `json:"command_generated,omitempty"`
    ArtifactGenerated *ArtifactSpec `json:"artifact_generated,omitempty"`
}
```

### 3. Different Prompts for Different Types

```go
func getCrystallizationPrompt(crystallizeType string) string {
    switch crystallizeType {
    case "command":
        return "I want you to CREATE A COMMAND based on our conversation..."
    case "document":
        return "I want you to CREATE A DOCUMENT based on our conversation. Generate a markdown document that captures the key insights, decisions, or knowledge we've discussed. Format it with clear sections and actionable content."
    case "data":
        return "I want you to CREATE A DATA MANAGEMENT COMMAND based on our conversation. This should be a command that manages structured data with CRUD operations (create, read, update, delete). Include the data schema and operations."
    default:
        return "Based on our conversation, please create the most appropriate artifact: either a command (executable tool), a document (markdown knowledge), or a data management tool (CRUD operations). Choose what best captures our discussion."
    }
}
```

### 4. Document Generation

Documents would be saved to `~/.port42/artifacts/` with organization:

```
~/.port42/artifacts/
├── decisions/
│   └── 2024-01-15-api-architecture.md
├── strategies/
│   └── 2024-01-15-growth-plan.md
├── knowledge/
│   └── 2024-01-15-competitor-analysis.md
└── index.json
```

### 5. Data Management Command Template

```bash
#!/bin/bash
# Generated by Port 42
# Data management command for: {{.Name}}
# Schema: {{.Schema}}

DATA_FILE="$HOME/.port42/data/{{.Name}}.json"

case "$1" in
    create)
        # Create new entry
        ;;
    list)
        # List all entries
        ;;
    update)
        # Update existing entry
        ;;
    delete)
        # Delete entry
        ;;
    *)
        echo "Usage: {{.Name}} [create|list|update|delete]"
        ;;
esac
```

## Benefits

1. **User Control**: Explicitly choose output type when needed
2. **AI Intelligence**: Let AI decide when type not specified
3. **Clear Organization**: Different storage for different artifact types
4. **Extensibility**: Easy to add new crystallization types

## Migration Path

1. Keep existing `/crystallize` behavior as default
2. Add new options incrementally
3. Update documentation and examples
4. Gather user feedback and iterate